{"version":3,"sources":["../src/tenant-registry.ts"],"sourcesContent":["import type { RegistryTenant } from './types';\r\nimport { ensureTenantCatalog } from './catalog-store';\r\nimport { getDeliverySettings, saveDeliverySettings } from './delivery-store';\r\n\r\nconst STORAGE_KEY = 'nmd.tenants';\r\n\r\nfunction load(): RegistryTenant[] {\r\n  try {\r\n    const raw = localStorage.getItem(STORAGE_KEY);\r\n    if (raw) return JSON.parse(raw);\r\n  } catch {\r\n    /* ignore */\r\n  }\r\n  return [];\r\n}\r\n\r\nfunction save(tenants: RegistryTenant[]): void {\r\n  localStorage.setItem(STORAGE_KEY, JSON.stringify(tenants));\r\n}\r\n\r\nexport function listTenants(): RegistryTenant[] {\r\n  return load();\r\n}\r\n\r\nexport function listEnabledTenants(): RegistryTenant[] {\r\n  return load().filter((t) => t.enabled);\r\n}\r\n\r\nexport function getTenantById(id: string): RegistryTenant | null {\r\n  return load().find((t) => t.id === id) ?? null;\r\n}\r\n\r\nexport function getTenantBySlug(slug: string): RegistryTenant | null {\r\n  return load().find((t) => t.slug === slug) ?? null;\r\n}\r\n\r\nconst DEFAULT_HERO = { title: 'مرحباً بك', subtitle: 'اكتشف أفضل المنتجات لدينا', ctaText: 'تسوق الآن', ctaLink: '#' };\r\n\r\nexport function createTenant(input: Omit<RegistryTenant, 'id' | 'createdAt'>): RegistryTenant {\r\n  const id = crypto.randomUUID?.() ?? `t-${Date.now()}`;\r\n  const tenant: RegistryTenant = {\r\n    ...input,\r\n    id,\r\n    createdAt: new Date().toISOString(),\r\n    hero: input.hero ?? DEFAULT_HERO,\r\n    banners: input.banners ?? [],\r\n  };\r\n  const tenants = load();\r\n  tenants.push(tenant);\r\n  save(tenants);\r\n  ensureTenantCatalog(tenant.id);\r\n  if (!getDeliverySettings(tenant.id)) {\r\n    saveDeliverySettings(tenant.id, {\r\n      tenantId: tenant.id,\r\n      modes: { pickup: true, delivery: true },\r\n      deliveryFee: 5,\r\n      zones: [],\r\n    });\r\n  }\r\n  return tenant;\r\n}\r\n\r\nexport function updateTenant(id: string, updates: Partial<Omit<RegistryTenant, 'id' | 'createdAt'>>): RegistryTenant | null {\r\n  const tenants = load();\r\n  const idx = tenants.findIndex((t) => t.id === id);\r\n  if (idx === -1) return null;\r\n  tenants[idx] = { ...tenants[idx], ...updates };\r\n  save(tenants);\r\n  return tenants[idx];\r\n}\r\n\r\nexport function toggleTenant(id: string): RegistryTenant | null {\r\n  const tenants = load();\r\n  const idx = tenants.findIndex((t) => t.id === id);\r\n  if (idx === -1) return null;\r\n  tenants[idx] = { ...tenants[idx], enabled: !tenants[idx].enabled };\r\n  save(tenants);\r\n  return tenants[idx];\r\n}\r\n"],"mappings":";;;;;;;;;AAIA,IAAM,cAAc;AAEpB,SAAS,OAAyB;AAChC,MAAI;AACF,UAAM,MAAM,aAAa,QAAQ,WAAW;AAC5C,QAAI,IAAK,QAAO,KAAK,MAAM,GAAG;AAAA,EAChC,QAAQ;AAAA,EAER;AACA,SAAO,CAAC;AACV;AAEA,SAAS,KAAK,SAAiC;AAC7C,eAAa,QAAQ,aAAa,KAAK,UAAU,OAAO,CAAC;AAC3D;AAEO,SAAS,cAAgC;AAC9C,SAAO,KAAK;AACd;AAEO,SAAS,qBAAuC;AACrD,SAAO,KAAK,EAAE,OAAO,CAAC,MAAM,EAAE,OAAO;AACvC;AAEO,SAAS,cAAc,IAAmC;AAC/D,SAAO,KAAK,EAAE,KAAK,CAAC,MAAM,EAAE,OAAO,EAAE,KAAK;AAC5C;AAEO,SAAS,gBAAgB,MAAqC;AACnE,SAAO,KAAK,EAAE,KAAK,CAAC,MAAM,EAAE,SAAS,IAAI,KAAK;AAChD;AAEA,IAAM,eAAe,EAAE,OAAO,qDAAa,UAAU,2IAA6B,SAAS,qDAAa,SAAS,IAAI;AAE9G,SAAS,aAAa,OAAiE;AAC5F,QAAM,KAAK,OAAO,aAAa,KAAK,KAAK,KAAK,IAAI,CAAC;AACnD,QAAM,SAAyB;AAAA,IAC7B,GAAG;AAAA,IACH;AAAA,IACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,IAClC,MAAM,MAAM,QAAQ;AAAA,IACpB,SAAS,MAAM,WAAW,CAAC;AAAA,EAC7B;AACA,QAAM,UAAU,KAAK;AACrB,UAAQ,KAAK,MAAM;AACnB,OAAK,OAAO;AACZ,sBAAoB,OAAO,EAAE;AAC7B,MAAI,CAAC,oBAAoB,OAAO,EAAE,GAAG;AACnC,yBAAqB,OAAO,IAAI;AAAA,MAC9B,UAAU,OAAO;AAAA,MACjB,OAAO,EAAE,QAAQ,MAAM,UAAU,KAAK;AAAA,MACtC,aAAa;AAAA,MACb,OAAO,CAAC;AAAA,IACV,CAAC;AAAA,EACH;AACA,SAAO;AACT;AAEO,SAAS,aAAa,IAAY,SAAmF;AAC1H,QAAM,UAAU,KAAK;AACrB,QAAM,MAAM,QAAQ,UAAU,CAAC,MAAM,EAAE,OAAO,EAAE;AAChD,MAAI,QAAQ,GAAI,QAAO;AACvB,UAAQ,GAAG,IAAI,EAAE,GAAG,QAAQ,GAAG,GAAG,GAAG,QAAQ;AAC7C,OAAK,OAAO;AACZ,SAAO,QAAQ,GAAG;AACpB;AAEO,SAAS,aAAa,IAAmC;AAC9D,QAAM,UAAU,KAAK;AACrB,QAAM,MAAM,QAAQ,UAAU,CAAC,MAAM,EAAE,OAAO,EAAE;AAChD,MAAI,QAAQ,GAAI,QAAO;AACvB,UAAQ,GAAG,IAAI,EAAE,GAAG,QAAQ,GAAG,GAAG,SAAS,CAAC,QAAQ,GAAG,EAAE,QAAQ;AACjE,OAAK,OAAO;AACZ,SAAO,QAAQ,GAAG;AACpB;","names":[]}