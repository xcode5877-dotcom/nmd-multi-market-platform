import{G as h,H as j,u as C,r as p,J as f,j as t,L as A,B as u,C as I,q as o,S as n,K as T,N as k}from"./index-D0pSccYm.js";import{u as N}from"./useAdminData-iM1CNBvB.js";import"./admin-data-DX2UwLRf.js";function R(){const{id:r}=h(),m=j(),{tenantId:d}=C(),c=N(d),g=c.getCategories(),x=c.getProducts(),[a,l]=p.useState({name:"",status:"draft",type:"PERCENT",value:0,appliesTo:"ALL",categoryIds:[],productIds:[],startAt:"",endAt:"",stackable:!1,priority:0});p.useEffect(()=>{if(r){const e=f(r);e&&l({name:e.name,status:e.status,type:e.type,value:e.value,appliesTo:e.appliesTo??"ALL",categoryIds:e.categoryIds??[],productIds:e.productIds??[],startAt:e.startAt??"",endAt:e.endAt??"",stackable:e.stackable??!1,priority:e.priority??0})}},[r]);const v=()=>{if(!a.name.trim())return;const e={tenantId:d,name:a.name,status:a.status,type:a.type,value:a.value,appliesTo:a.appliesTo,categoryIds:a.appliesTo==="CATEGORIES"?a.categoryIds:void 0,productIds:a.appliesTo==="PRODUCTS"?a.productIds:void 0,startAt:a.startAt||void 0,endAt:a.endAt||void 0,stackable:a.stackable,priority:a.priority??0};r?T(r,e):k(e),m("/campaigns")},b=e=>{l(s=>({...s,categoryIds:s.categoryIds.includes(e)?s.categoryIds.filter(i=>i!==e):[...s.categoryIds,e]}))},y=e=>{l(s=>({...s,productIds:s.productIds.includes(e)?s.productIds.filter(i=>i!==e):[...s.productIds,e]}))};return t.jsxs("div",{children:[t.jsxs("div",{className:"flex justify-between items-center mb-6",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:r?"تعديل الحملة":"إضافة حملة"}),t.jsx(A,{to:"/campaigns",children:t.jsx(u,{variant:"ghost",children:"إلغاء"})})]}),t.jsxs(I,{className:"p-6 max-w-2xl",children:[t.jsxs("div",{className:"space-y-4",children:[t.jsx(o,{label:"الاسم",value:a.name,onChange:e=>l(s=>({...s,name:e.target.value}))}),t.jsx(n,{label:"الحالة",options:[{value:"draft",label:"مسودة"},{value:"active",label:"نشطة"},{value:"paused",label:"متوقفة"}],value:a.status,onChange:e=>l(s=>({...s,status:e.target.value}))}),t.jsx(n,{label:"النوع",options:[{value:"PERCENT",label:"نسبة مئوية"},{value:"FIXED",label:"مبلغ ثابت"}],value:a.type,onChange:e=>l(s=>({...s,type:e.target.value}))}),t.jsx(o,{label:"القيمة",type:"number",value:a.value,onChange:e=>l(s=>({...s,value:+e.target.value}))}),t.jsx(n,{label:"ينطبق على",options:[{value:"ALL",label:"الكل"},{value:"CATEGORIES",label:"تصنيفات"},{value:"PRODUCTS",label:"منتجات"}],value:a.appliesTo,onChange:e=>l(s=>({...s,appliesTo:e.target.value}))}),a.appliesTo==="CATEGORIES"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"التصنيفات"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(e=>t.jsx("button",{type:"button",onClick:()=>b(e.id),className:`px-3 py-1 rounded-lg text-sm border ${a.categoryIds.includes(e.id)?"bg-primary text-white border-primary":"border-gray-300"}`,children:e.name},e.id))})]}),a.appliesTo==="PRODUCTS"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"المنتجات"}),t.jsx("div",{className:"flex flex-wrap gap-2 max-h-40 overflow-auto",children:x.map(e=>t.jsx("button",{type:"button",onClick:()=>y(e.id),className:`px-3 py-1 rounded-lg text-sm border ${a.productIds.includes(e.id)?"bg-primary text-white border-primary":"border-gray-300"}`,children:e.name},e.id))})]}),t.jsx(o,{label:"بداية (اختياري)",type:"datetime-local",value:a.startAt,onChange:e=>l(s=>({...s,startAt:e.target.value}))}),t.jsx(o,{label:"نهاية (اختياري)",type:"datetime-local",value:a.endAt,onChange:e=>l(s=>({...s,endAt:e.target.value}))}),t.jsxs("label",{className:"flex items-center gap-2",children:[t.jsx("input",{type:"checkbox",checked:a.stackable,onChange:e=>l(s=>({...s,stackable:e.target.checked}))}),"قابلة للتراكم"]})]}),t.jsx("div",{className:"mt-6",children:t.jsx(u,{onClick:v,children:"حفظ"})})]})]})}export{R as default};
