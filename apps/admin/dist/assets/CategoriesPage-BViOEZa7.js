import{u as z,r as i,j as s,B as o,C as D,o as A,q as k,S as R,e as B,s as M}from"./index-D0pSccYm.js";import{u as $}from"./useAdminData-iM1CNBvB.js";import"./admin-data-DX2UwLRf.js";function V(){const{tenantId:C}=z(),r=$(C),[d,g]=i.useState(()=>r.getCategories()),h=i.useRef(!0);i.useEffect(()=>{h.current&&!r.isLoading&&(g(r.getCategories()),h.current=!1),r.isLoading&&(h.current=!0)},[r.isLoading]);const[f,j]=i.useState(null),[y,u]=i.useState(!1),[a,c]=i.useState({name:"",slug:"",parentId:null}),[m,x]=i.useState(null),[S,w]=i.useState(new Set),E=e=>{w(n=>{const t=new Set(n);return t.has(e)?t.delete(e):t.add(e),t})},v=d.filter(e=>!e.parentId||e.parentId===""),I=e=>d.filter(n=>n.parentId===e).sort((n,t)=>(n.sortOrder??0)-(t.sortOrder??0)),O=()=>{if(!a.name.trim())return;const e=a.slug||a.name.toLowerCase().replace(/\s/g,"-");if(f){const n=d.map(t=>t.id===f.id?{...t,name:a.name,slug:e,parentId:a.parentId??null}:t);g(n),r.setCategories(n)}else{const n=a.parentId?I(a.parentId):v,t=[...d,{id:M(),tenantId:C,name:a.name,slug:e,sortOrder:n.length,parentId:a.parentId??null,isVisible:!0}];g(t),r.setCategories(t)}u(!1),j(null),c({name:"",slug:"",parentId:null})},L=e=>{const n=[e,...d.filter(l=>l.parentId===e).map(l=>l.id)],t=d.filter(l=>!n.includes(l.id));g(t),r.setCategories(t),x(null)},b=e=>{j(e),c({name:e.name,slug:e.slug,parentId:e.parentId??null}),u(!0)},N=e=>{j(null),c({name:"",slug:"",parentId:e??null}),u(!0)};return s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"التصنيفات"}),s.jsx(o,{onClick:()=>N(),children:"إضافة تصنيف"})]}),s.jsx(D,{children:s.jsx("div",{className:"divide-y divide-gray-200",children:v.sort((e,n)=>(e.sortOrder??0)-(n.sortOrder??0)).map(e=>{const n=I(e.id),t=n.length>0,l=S.has(e.id);return s.jsxs("div",{className:"rtl",children:[s.jsxs("div",{className:"flex items-center justify-between p-4 gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[t?s.jsx("button",{type:"button",onClick:()=>E(e.id),className:"p-1 rounded hover:bg-gray-100 transition-colors flex-shrink-0","aria-expanded":l,children:s.jsx("span",{className:`inline-block transition-transform ${l?"rotate-90":""}`,children:"▶"})}):s.jsx("span",{className:"w-6 flex-shrink-0"}),s.jsx("span",{className:"font-medium truncate",children:e.name})]}),s.jsxs("div",{className:"flex gap-2 flex-shrink-0",children:[s.jsx(o,{variant:"outline",size:"sm",onClick:()=>N(e.id),title:"إضافة فرعي",children:"+"}),s.jsx(o,{variant:"outline",size:"sm",onClick:()=>b(e),children:"تعديل"}),s.jsx(o,{variant:"ghost",size:"sm",onClick:()=>x(e),className:"text-red-600",children:"حذف"})]})]}),t&&l&&s.jsx("div",{className:"me-14 ps-4 border-s-2 border-gray-200 bg-gray-50/50",children:n.map(p=>s.jsxs("div",{className:"flex items-center justify-between py-2 px-3 hover:bg-gray-50/50",children:[s.jsxs("span",{className:"text-gray-600",children:["— ",p.name]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(o,{variant:"outline",size:"sm",onClick:()=>b(p),children:"تعديل"}),s.jsx(o,{variant:"ghost",size:"sm",onClick:()=>x(p),className:"text-red-600",children:"حذف"})]})]},p.id))})]},e.id)})})}),s.jsxs(A,{open:y,onClose:()=>u(!1),title:f?"تعديل تصنيف":"إضافة تصنيف",children:[s.jsx(k,{label:"الاسم",value:a.name,onChange:e=>c(n=>({...n,name:e.target.value}))}),s.jsx(k,{label:"Slug",value:a.slug,onChange:e=>c(n=>({...n,slug:e.target.value})),className:"mt-4"}),s.jsx(R,{label:"التصنيف الأب (اختياري)",value:a.parentId??"",onChange:e=>c(n=>({...n,parentId:e.target.value||null})),options:[{value:"",label:"— تصنيف رئيسي —"},...v.map(e=>({value:e.id,label:e.name}))],className:"mt-4"}),s.jsxs("div",{className:"mt-6 flex gap-2",children:[s.jsx(o,{onClick:O,children:"حفظ"}),s.jsx(o,{variant:"ghost",onClick:()=>u(!1),children:"إلغاء"})]})]}),s.jsx(B,{open:!!m,onClose:()=>x(null),onConfirm:()=>m&&L(m.id),title:"حذف التصنيف",message:`هل أنت متأكد من حذف "${m==null?void 0:m.name}"؟`,confirmLabel:"حذف",variant:"danger"})]})}export{V as default};
