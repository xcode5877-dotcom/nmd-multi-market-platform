import{u as k,a as O,h as w,r as h,b as q,j as s,C as D,B as c,t as S,o as E,q as u,M as Q}from"./index-D0pSccYm.js";const o=new Q,j=!1;function T(){const{tenantId:a}=k(),m=O(),i=w().addToast,[f,l]=h.useState(!1),[d,v]=h.useState(null),[n,r]=h.useState({name:"",fee:0,etaMinutes:0,isActive:!0,sortOrder:0}),{data:g=[],isLoading:A}=q({queryKey:["delivery-zones",a],queryFn:()=>o.getDeliveryZones(a),enabled:!!a}),x=[...g].sort((e,t)=>{const y=e.sortOrder??999,p=t.sortOrder??999;return y!==p?y-p:(e.name??"").localeCompare(t.name??"")}),b=()=>{v(null),r({name:"",fee:0,etaMinutes:0,isActive:!0,sortOrder:x.length}),l(!0)},C=e=>{v(e),r({name:e.name,fee:e.fee,etaMinutes:e.etaMinutes??0,isActive:e.isActive??!0,sortOrder:e.sortOrder??0}),l(!0)},N=async()=>{if(n.name.trim())try{j||(d?(await o.updateDeliveryZoneApi(a,d.id,n),i("تم تحديث المنطقة","success")):(await o.createDeliveryZoneApi(a,n),i("تم إضافة المنطقة","success"))),m.invalidateQueries({queryKey:["delivery-zones",a]}),l(!1)}catch{i("حدث خطأ","error")}},M=async e=>{try{j||await o.patchDeliveryZoneApi(a,e.id,{isActive:!e.isActive}),m.invalidateQueries({queryKey:["delivery-zones",a]}),i(e.isActive?"تم إخفاء المنطقة":"تم تفعيل المنطقة","success")}catch{i("حدث خطأ","error")}},Z=async e=>{try{await o.deleteDeliveryZoneApi(a,e),m.invalidateQueries({queryKey:["delivery-zones",a]}),i("تم حذف المنطقة","success"),l(!1)}catch{i("حدث خطأ","error")}};return A?s.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:s.jsx("div",{className:"animate-spin w-10 h-10 border-2 border-primary border-t-transparent rounded-full"})}):s.jsxs("div",{children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"مناطق التوصيل"}),s.jsx(D,{className:"p-6 max-w-2xl space-y-6",children:s.jsxs("div",{children:[s.jsxs("div",{className:"flex justify-between items-center mb-2",children:[s.jsx("label",{className:"font-medium",children:"المناطق"}),s.jsx(c,{size:"sm",onClick:b,children:"إضافة منطقة"})]}),s.jsx("div",{className:"divide-y divide-gray-200",children:x.length===0?s.jsx("p",{className:"text-gray-500 py-4",children:"لا توجد مناطق. أضف منطقة لتوصيل العملاء."}):x.map(e=>s.jsxs("div",{className:"flex justify-between items-center py-3",children:[s.jsxs("div",{children:[s.jsx("span",{className:`font-medium ${e.isActive?"":"text-gray-400 line-through"}`,children:e.name}),s.jsxs("span",{className:"text-gray-500 text-sm me-2",children:["- ",S(e.fee)]}),e.etaMinutes?s.jsxs("span",{className:"text-xs text-gray-400",children:["(",e.etaMinutes," د)"]}):null,!e.isActive&&s.jsx("span",{className:"text-xs text-amber-600 me-2",children:"(غير نشط)"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(c,{variant:"outline",size:"sm",onClick:()=>M(e),children:e.isActive?"إخفاء":"تفعيل"}),s.jsx(c,{variant:"outline",size:"sm",onClick:()=>C(e),children:"تعديل"}),s.jsx(c,{variant:"ghost",size:"sm",className:"text-red-600",onClick:()=>Z(e.id),children:"حذف"})]})]},e.id))})]})}),s.jsxs(E,{open:f,onClose:()=>l(!1),title:d?"تعديل منطقة":"إضافة منطقة",children:[s.jsxs("div",{className:"space-y-4",children:[s.jsx(u,{label:"الاسم",value:n.name,onChange:e=>r(t=>({...t,name:e.target.value}))}),s.jsx(u,{label:"الرسوم (₪)",type:"number",value:n.fee,onChange:e=>r(t=>({...t,fee:+e.target.value}))}),s.jsx(u,{label:"الوقت التقريبي (دقيقة)",type:"number",value:n.etaMinutes,onChange:e=>r(t=>({...t,etaMinutes:+e.target.value}))}),s.jsx(u,{label:"ترتيب العرض",type:"number",value:n.sortOrder,onChange:e=>r(t=>({...t,sortOrder:+e.target.value}))}),d&&s.jsxs("label",{className:"flex items-center gap-2",children:[s.jsx("input",{type:"checkbox",checked:n.isActive,onChange:e=>r(t=>({...t,isActive:e.target.checked}))}),"نشط"]})]}),s.jsxs("div",{className:"mt-6 flex gap-2",children:[s.jsx(c,{onClick:N,children:"حفظ"}),s.jsx(c,{variant:"ghost",onClick:()=>l(!1),children:"إلغاء"})]})]})]})}export{T as default};
