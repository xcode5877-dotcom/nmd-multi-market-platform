import{l as C,d as D,h as F,c as p,i as L,k,t as O,r as z,j as e,v as P,w as I,L as w,B as o,x as $,y as B,z as y,A as g,C as u,E as K,M as Q}from"./index-BYQekpkv.js";import{A as U}from"./arrow-left-D6cBPTnX.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=C("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=C("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]),l=new Q,r=!1,V=5174,Y=5173;function ae(){var v,b,f;const c=D(),s=c.tenantId??c.id,x=F(),{data:G,isLoading:J}=p({queryKey:["tenant-registry",s],queryFn:()=>l.getTenantById(s),enabled:!!s&&r}),{data:W}=p({queryKey:["catalog",s],queryFn:()=>l.getCatalogApi(s),enabled:!!s&&r}),{data:X=[]}=p({queryKey:["orders",s],queryFn:()=>l.listOrdersByTenant(s),enabled:!!s&&r}),i=L().addToast;k({mutationFn:t=>l.markOrderReady(s,t),onSuccess:()=>{x.invalidateQueries({queryKey:["orders",s]}),i("تم تعليم الطلب جاهزاً","success")},onError:t=>i(t instanceof Error?t.message:"فشل","error")});const m=k({mutationFn:()=>l.applyTemplateApi(s,"clothing"),onSuccess:()=>{x.invalidateQueries({queryKey:["tenant-registry",s]}),x.invalidateQueries({queryKey:["catalog",s]}),i("تم تطبيق القالب بنجاح","success")},onError:t=>i(t instanceof Error?t.message:"فشل تطبيق القالب","error")}),a=s?O(s):null,[E,S]=z.useState("branding");if(!a)return e.jsx("div",{className:"p-8 text-center text-gray-500",children:"المستأجر غير موجود"});const h=P(a.id),j=(a.tenantType??(a.type==="FOOD"?"RESTAURANT":"SHOP"))==="RESTAURANT",N=I(a.id).sort((t,n)=>new Date(n.createdAt).getTime()-new Date(t.createdAt).getTime()).slice(0,20),M=`http://localhost:${V}/?tenant=${a.slug}`,R=`http://localhost:${Y}/?tenant=${a.slug}`,d=c.tenantId?c.id:void 0;return e.jsxs("div",{children:[d&&e.jsxs(w,{to:`/markets/${d}/tenants`,className:"inline-flex items-center gap-1 text-sm text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(U,{className:"w-4 h-4"}),"رجوع للمستأجرين"]}),e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-xl flex items-center justify-center text-white font-bold text-2xl",style:{backgroundColor:a.primaryColor},children:a.name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a.name}),e.jsxs("p",{className:"text-gray-500",children:["/",a.slug]})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs(o,{size:"sm",variant:"outline",onClick:()=>m.mutate(),disabled:m.isPending,className:"gap-1.5",children:[e.jsx(H,{className:"w-4 h-4"}),m.isPending?"جاري التطبيق...":"تطبيق قالب جاهز"]}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>window.open(M,"_blank"),children:"فتح لوحة المستأجر"}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>window.open(R,"_blank"),children:"فتح المتجر"}),e.jsx(w,{to:d?`/markets/${d}/tenants/${s}/settings/delivery`:`/tenants/${s}/settings/delivery`,children:e.jsxs(o,{size:"sm",variant:"outline",className:"gap-1.5",children:[e.jsx(_,{className:"w-4 h-4"}),"إعدادات التوصيل"]})})]})]}),e.jsxs($,{value:E,onChange:S,children:[e.jsxs(B,{children:[e.jsx(y,{value:"branding",children:"العلامة التجارية"}),e.jsx(y,{value:"catalog",children:"الكتالوج"}),e.jsx(y,{value:"orders",children:"الطلبات"})]}),e.jsx(g,{value:"branding",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"اللون الأساسي:"})," ",e.jsx("span",{className:"font-mono",style:{color:a.primaryColor},children:a.primaryColor})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"اللون الثانوي:"})," ",e.jsx("span",{className:"font-mono",style:{color:a.secondaryColor},children:a.secondaryColor})]}),e.jsxs("p",{children:[e.jsx("span",{className:"text-gray-500",children:"الخط:"})," ",a.fontFamily]})]})})}),e.jsx(g,{value:"catalog",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:((v=h.categories)==null?void 0:v.length)??0}),e.jsx("p",{className:"text-sm text-gray-500",children:"تصنيفات"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:((b=h.products)==null?void 0:b.length)??0}),e.jsx("p",{className:"text-sm text-gray-500",children:"منتجات"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-gray-50",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:((f=h.optionGroups)==null?void 0:f.length)??0}),e.jsx("p",{className:"text-sm text-gray-500",children:"مجموعات خيارات"})]})]})})}),e.jsx(g,{value:"orders",children:e.jsxs(u,{className:"p-6",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"آخر 20 طلب"}),N.length===0?e.jsx("p",{className:"text-gray-500",children:"لا توجد طلبات"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-start py-2",children:"#"}),e.jsx("th",{className:"text-start py-2",children:"التاريخ"}),e.jsx("th",{className:"text-start py-2",children:"الإجمالي"}),e.jsx("th",{className:"text-start py-2",children:"الحالة"}),j&&e.jsx("th",{className:"text-start py-2",children:"جاهز في"}),r]})}),e.jsx("tbody",{children:N.map(t=>{const n=t,T=n.readyAt?new Date(n.readyAt):null,q=new Date,A=T?Math.max(0,Math.round((T.getTime()-q.getTime())/6e4)):null;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 font-mono",children:t.id.slice(0,8)}),e.jsx("td",{className:"py-2",children:new Date(t.createdAt).toLocaleDateString("ar-SA")}),e.jsx("td",{className:"py-2",children:K(t.total)}),e.jsxs("td",{className:"py-2",children:[e.jsx("span",{className:n.status==="READY"?"text-green-600 font-medium":"",children:n.status??t.status}),n.fallbackTriggeredAt&&e.jsx("span",{className:"ms-1 text-xs text-amber-600",title:"انتقل لتوصيل السوق",children:"↗"})]}),j&&e.jsx("td",{className:"py-2",children:n.status==="READY"?e.jsx("span",{className:"text-green-600",children:"جاهز"}):A!==null?e.jsxs("span",{children:[A," د"]}):"-"}),r]},t.id)})})]})})]})})]})]})}export{ae as default};
