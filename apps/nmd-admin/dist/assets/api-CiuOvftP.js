const E="",f="nmd-access-token";let n=!1,a="";function _(r,e){n=r&&!!e.trim(),a=e.trim(),typeof window<"u"&&(window.__NMD_EMERGENCY_HEADERS__=n?{"X-Emergency-Mode":"true"}:{},window.__NMD_EMERGENCY_REASON__=n?a:"")}function d(){const r={"Content-Type":"application/json"},e=typeof localStorage<"u"?localStorage.getItem(f):null;return e&&(r.Authorization=`Bearer ${e}`),n&&(r["X-Emergency-Mode"]="true"),r}function u(r,e){if(!n||!a||!["POST","PUT","PATCH","DELETE"].includes((e||"GET").toUpperCase()))return r;try{const s=r?JSON.parse(r):{},t={...s,_meta:{...s._meta,emergencyReason:a}};return JSON.stringify(t)}catch{return r}}async function w(r,e){const c=(e==null?void 0:e.method)??"GET",s=u(e==null?void 0:e.body,c),t=await fetch(`${E}${r}`,{...e,method:c,body:s,headers:{...d(),...e==null?void 0:e.headers}});if(!t.ok)try{const o=await t.json();throw o.code==="EMERGENCY_MODE_REQUIRED"?new Error("فعّل وضع الطوارئ مع سبب للتعديل"):o.code==="EMERGENCY_REASON_REQUIRED"?new Error("السبب مطلوب في وضع الطوارئ"):new Error(o.error??`API error: ${t.status}`)}catch(o){throw o instanceof Error?o:new Error(`API error: ${t.status}`)}if(t.status!==204)return t.json()}export{d as a,w as b,_ as s};
