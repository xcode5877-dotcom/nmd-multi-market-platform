import{s as P,t as T}from"./index-DqbWLIhh.js";function E(i,m){let t;try{t=i()}catch{return}return{getItem:s=>{var e;const c=d=>d===null?null:JSON.parse(d,void 0),a=(e=t.getItem(s))!=null?e:null;return a instanceof Promise?a.then(c):c(a)},setItem:(s,e)=>t.setItem(s,JSON.stringify(e,void 0)),removeItem:s=>t.removeItem(s)}}const _=i=>m=>{try{const t=i(m);return t instanceof Promise?t:{then(n){return _(n)(t)},catch(n){return this}}}catch(t){return{then(n){return this},catch(n){return _(n)(t)}}}},R=(i,m)=>(t,n,s)=>{let e={storage:E(()=>window.localStorage),partialize:r=>r,version:0,merge:(r,v)=>({...v,...r}),...m},c=!1,a=0;const d=new Set,p=new Set;let u=e.storage;if(!u)return i((...r)=>{console.warn(`[zustand persist middleware] Unable to update item '${e.name}', the given storage is currently unavailable.`),t(...r)},n,s);const y=()=>{const r=e.partialize({...n()});return u.setItem(e.name,{state:r,version:e.version})},w=s.setState;s.setState=(r,v)=>(w(r,v),y());const h=i((...r)=>(t(...r),y()),n,s);s.getInitialState=()=>h;let f;const b=()=>{var r,v;if(!u)return;const S=++a;c=!1,d.forEach(o=>{var l;return o((l=n())!=null?l:h)});const g=((v=e.onRehydrateStorage)==null?void 0:v.call(e,(r=n())!=null?r:h))||void 0;return _(u.getItem.bind(u))(e.name).then(o=>{if(o)if(typeof o.version=="number"&&o.version!==e.version){if(e.migrate){const l=e.migrate(o.state,o.version);return l instanceof Promise?l.then(I=>[!0,I]):[!0,l]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,o.state];return[!1,void 0]}).then(o=>{var l;if(S!==a)return;const[I,H]=o;if(f=e.merge(H,(l=n())!=null?l:h),t(f,!0),I)return y()}).then(()=>{S===a&&(g==null||g(f,void 0),f=n(),c=!0,p.forEach(o=>o(f)))}).catch(o=>{S===a&&(g==null||g(void 0,o))})};return s.persist={setOptions:r=>{e={...e,...r},r.storage&&(u=r.storage)},clearStorage:()=>{u==null||u.removeItem(e.name)},getOptions:()=>e,rehydrate:()=>b(),hasHydrated:()=>c,onHydrate:r=>(d.add(r),()=>{d.delete(r)}),onFinishHydration:r=>(p.add(r),()=>{p.delete(r)})},e.skipHydration||b(),f||h},C=R,F=[],N=P()(C((i,m)=>({carts:{},lastAddTimestamp:void 0,addItem:(t,n)=>i(s=>({lastAddTimestamp:Date.now(),carts:{...s.carts,[t]:[...s.carts[t]??[],{...n,id:T()}]}})),updateQuantity:(t,n,s)=>i(e=>{const c=e.carts[t]??[];return s<=0?{carts:{...e.carts,[t]:c.filter(a=>a.id!==n)}}:{carts:{...e.carts,[t]:c.map(a=>a.id===n?{...a,quantity:s,totalPrice:a.totalPrice/a.quantity*s}:a)}}}),removeItem:(t,n)=>i(s=>({carts:{...s.carts,[t]:(s.carts[t]??[]).filter(e=>e.id!==n)}})),clearCart:t=>i(n=>({carts:{...n.carts,[t]:[]}})),getItems:t=>m().carts[t]??F}),{name:"nmd-cart",partialize:i=>({carts:i.carts})}));export{N as u};
