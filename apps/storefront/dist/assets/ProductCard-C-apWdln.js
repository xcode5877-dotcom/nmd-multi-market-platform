import{r as l,c as w,e as $,b as D,g as P,j as t,L as E,S as q,f as d}from"./index-DqbWLIhh.js";import{u as U}from"./cart-_Jxk0B-k.js";import{S as A}from"./shopping-cart-Cv9GfYq0.js";const B=14;function G(e){if(!e)return!1;const a=new Date(e).getTime(),s=Date.now()-B*24*60*60*1e3;return a>=s}function v(e){return(e.optionGroups??[]).some(s=>{var n;return(((n=s.items)==null?void 0:n.length)??0)>0})}function R({product:e,campaigns:a}){const{discount:s}=P(e.basePrice,a,e.id,e.categoryId),n=e.basePrice-s;return s>0?t.jsxs("p",{className:"font-semibold text-primary text-[16px] md:text-[17px]",children:[t.jsx("span",{className:"line-through text-gray-400 text-xs font-medium me-1",children:d(e.basePrice)}),d(n)]}):t.jsx("p",{className:"font-semibold text-gray-900 text-[16px] md:text-[17px]",children:d(e.basePrice)})}function O({onClick:e,disabled:a,isBouncing:s,ariaLabel:n}){return t.jsx("button",{type:"button",onClick:e,disabled:a,className:`flex-shrink-0 w-9 h-9 rounded-full bg-primary/12 text-primary shadow-sm flex items-center justify-center hover:bg-primary hover:text-white hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed ${s?"animate-bounce-subtle":""}`,"aria-label":n,children:t.jsx(A,{className:"w-4 h-4",strokeWidth:1.75})})}function W({product:e,campaigns:a}){var b,y;const s=w(i=>i.tenantId)??"default",n=w(i=>i.tenantSlug)??s,u=U(i=>i.addItem),x=$().addToast,f=D(),r=l.useRef(null),[g,h]=l.useState(!1),[I,p]=l.useState(!1);l.useEffect(()=>()=>{r.current&&clearTimeout(r.current)},[]);const S=G(e.createdAt),{discount:c}=P(e.basePrice,a,e.id,e.categoryId),k=c>0,m=v(e),o=e.inStock??!0,C=l.useCallback(i=>{var j,N;if(i.preventDefault(),i.stopPropagation(),!o)return;if(m){f(`/${n}/p/${e.id}`);return}const L=e.basePrice-c;u(s,{productId:e.id,productName:e.name,categoryId:e.categoryId,quantity:1,basePrice:e.basePrice,selectedOptions:[],optionGroups:e.optionGroups??[],totalPrice:L,imageUrl:((N=(j=e.images)==null?void 0:j[0])==null?void 0:N.url)??e.imageUrl}),x("انضاف للسلة","success"),p(!0),r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{p(!1),r.current=null},250)},[o,m,e,c,f,u,s,x]),T=((y=(b=e.images)==null?void 0:b[0])==null?void 0:y.url)??e.imageUrl??"https://placehold.co/400x500?text=No+Image";return t.jsx(E,{to:`/${n}/p/${e.id}`,className:"block group",children:t.jsxs("article",{className:"bg-white rounded-2xl shadow-sm hover:shadow-md overflow-hidden transition-all duration-200",dir:"rtl",children:[t.jsxs("div",{className:"aspect-[4/5] w-full bg-gray-100 relative overflow-hidden transition-shadow duration-300 group-hover:shadow-md",children:[!g&&t.jsx(q,{variant:"rectangular",className:"absolute inset-0 w-full h-full rounded-none"}),t.jsx("img",{src:T,alt:e.name,loading:"lazy",onLoad:()=>h(!0),onError:()=>h(!0),className:`w-full h-full object-cover transition-transform duration-300 ease-out group-hover:scale-105 ${g?"opacity-100":"opacity-0"}`}),t.jsxs("div",{className:"absolute top-2 end-2 flex flex-col gap-1.5",children:[S&&t.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary",children:"جديد"}),k&&t.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary",children:"خصم"}),!o&&t.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-gray-200/90 text-gray-600",children:"نفد"}),(e.isLastItems||e.quantity!=null&&e.lowStockThreshold!=null&&e.quantity<=e.lowStockThreshold)&&o&&t.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-amber-100/90 text-amber-800",children:["آخر ",e.lastItemsCount??e.quantity??0]})]})]}),t.jsxs("div",{className:"p-3 flex flex-col gap-0.5",children:[t.jsx("h3",{className:"text-[15px] md:text-[16px] font-medium text-gray-900 line-clamp-2 leading-snug",children:e.name}),t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx(R,{product:e,campaigns:a}),t.jsx(O,{onClick:C,disabled:!o,isBouncing:I,ariaLabel:m?"عرض المنتج":"أضف للسلة"})]}),v(e)&&t.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:"متوفر بعدة خيارات"})]})]})})}const Y=l.memo(W);export{Y as P};
